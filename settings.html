<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="firebase.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:white;}
.container{max-width:400px;margin:50px auto;background:#12172a;padding:25px;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,0.4);}
h2{text-align:center;margin-bottom:20px;}
label{margin-top:10px;display:block;}
input{width:100%;padding:12px;margin-top:5px;border:none;border-radius:8px;outline:none;background:#1b2140;color:white;}
button{width:100%;padding:12px;margin-top:15px;border:none;border-radius:8px;background:#1e90ff;color:white;cursor:pointer;}
button:hover{opacity:.9;}
.back{text-align:center;margin-top:10px;cursor:pointer;color:#7fb8ff;}
hr{border-color:#333;}

/* Ø²Ø± Ù†Ø³Ø® Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„ */
.copy-btn{
  padding:8px 12px;
  background:#1e90ff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:white;
}
.copy-container{
  display:flex;
  align-items:center;
  gap:5px;
}
.copy-container input{
  flex:1;
  background:#1b2140;
  color:#ccc;
  border-radius:8px;
  padding:10px;
}
</style>
</head>

<body>
<div class="container">
  <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>

  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
  <input id="usernameInput">

  <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
  <input id="emailInput" disabled>

  <button onclick="updateUsername()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…</button>

  <hr>

  <label>ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
  <input id="newEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
  <button onclick="updateEmail()">ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯</button>

  <button onclick="updatePassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  <hr>

  <!-- ğŸ†” UID -->
  <label>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UID)</label>
  <div class="copy-container">
    <input id="uidInput" readonly>
    <button class="copy-btn" onclick="copyUID()">Ù†Ø³Ø®</button>
  </div>

  <div class="back" onclick="goHome()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
</div>

<script>
let currentUser;

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© + ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
firebase.auth().onAuthStateChanged(user=>{
  if(!user) return window.location="index.html";
  currentUser = user;

  firebase.database().ref("usersefoot/"+user.uid)
    .once("value")
    .then(snap=>{
      const data = snap.val();
      document.getElementById("usernameInput").value = data.username;
      document.getElementById("emailInput").value = data.email;
      document.getElementById("uidInput").value = user.uid; // UID
    });
});

// =====================
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…
// =====================
function updateUsername(){
  const newName = document.getElementById("usernameInput").value.trim();
  if(newName==="") return alert("Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±Øº");

  firebase.database().ref("usersefoot/"+currentUser.uid).update({username:newName})
    .then(()=> alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…"))
    .catch(err=> alert(err.message));
}

// =====================
// ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
// =====================
function updateEmail(){
  const newEmail = document.getElementById("newEmail").value.trim();
  if(!newEmail) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯");

  const password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:");
  if(!password) return;

  const credential = firebase.auth.EmailAuthProvider.credential(
    currentUser.email,
    password
  );

  currentUser.reauthenticateWithCredential(credential)
    .then(() => {
      return currentUser.verifyBeforeUpdateEmail(newEmail);
    })
    .then(() => {
      return firebase.database().ref("usersefoot/" + currentUser.uid).update({email: newEmail});
    })
    .then(() => {
      document.getElementById("emailInput").value = newEmail;
      document.getElementById("newEmail").value = "";
      alert(
        "ğŸ“© ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ù‚Ø¯ÙŠÙ….\n" +
        "Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø³ÙŠØªØºÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª."
      );
    })
    .catch(err => alert("âŒ Ø®Ø·Ø£: " + err.message));
}

// =====================
// ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
// =====================
function updatePassword(){
  const newPass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„):");
  if(!newPass) return;
  if(newPass.length<6) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");

  const password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±:");
  if(!password) return;

  const credential = firebase.auth.EmailAuthProvider.credential(currentUser.email, password);

  currentUser.reauthenticateWithCredential(credential)
    .then(()=> currentUser.updatePassword(newPass))
    .then(()=> alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"))
    .catch(err=> alert("âŒ Ø®Ø·Ø£: " + err.message));
}

// =====================
// Ù†Ø³Ø® UID
// =====================
function copyUID(){
  const uidField = document.getElementById("uidInput");
  uidField.select();
  uidField.setSelectionRange(0, 99999); // Ù„Ù„Ø¬ÙˆØ§Ù„
  navigator.clipboard.writeText(uidField.value)
    .then(()=> alert("âœ… ØªÙ… Ù†Ø³Ø® UID"))
    .catch(()=> alert("âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®"));
}

// =====================
// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ + Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
// =====================
function logout(){firebase.auth().signOut().then(()=> window.location="index.html");}
function goHome(){window.location="home.html";}
</script>
</body>
</html>
